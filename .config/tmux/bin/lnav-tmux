#!/usr/bin/env bash

function _tmux_lnav_split() {
  local file="$1"
  local file_basedir=echo "$(dirname "$(readlink -m "$file")")"
  tmux split-window -v -c "$file_basedir" "lnav $file"
}

function open-nvim-log() {
  _tmux_lnav_split "$HOME/.local/state/nvim/log"
}

function open-nvim-nightly-log() {
  local nvim_repo="$HOME/.local/share/neovim"
  local xtest_cache="$nvim_repo/build/Xtest_xdg/cache"
  _tmux_lnav_split "$xtest_cache/nvim/*log*"
}

declare -a actions=(
  open-nvim-log
  open-nvim-nightly-log
)

SELECTION=$(
  printf "%s\n" "${actions[@]}" |
    fzf-tmux --exact --exit-0 --delimiter=' ' --reverse --header="select action "
) &&
  "$SELECTION"
